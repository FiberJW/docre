
<html>
<head>
<title>Reason code</title>
<script>

</script>
<style>
body {
  padding: 30px;
}
.value-identifier {
    color: #000;
}

.module-identifier {
  color: #aa0;
}

.type-module-identifier,
.let-module-identifier,
.constructor-module-identifier,
.switch-module-identifier,
.record-module-identifier,
.field-module-identifier {
  color: #a0a;
}

.type-value-identifier,
.let-value-identifier,
.switch-value-identifier,
.record-value-identifier,
.field-value-identifier {
  color: #0aa;
}

.unused-identifier {
  color: #00a;
}

.declaration-var {
  color: #a50000;
}

.string {
    color: #33a20d;
}

.int {
    color: blue;
}

.boolean {
    color: red;
}

.float {
    color: orange;
}

.operator {
  color: #9b9bff;
  font-weight: bold;
}

#main {
    color: #aaa;
    white-space: pre;
    font-family: 'sf mono', monospace;
}
.hovered {
  background-color: #d4ffe2;
}
/* span {
  display: inline-block;
  position: relative;
}
.id-badge {
  position: absolute;
  top: 100%;
  left: 0;
} */
[data-global]:not(.operator) {
  /* font-style: italic; */
  background-color: #fff3f2;
  /* text-decoration: underline;
  text-decoration-color: rgba(0, 0, 0, 0.5);
  text-decoration-style: dashed; */
}


/* .module-identifier,
.let-module-identifier,
.constructor-module-identifier,
.switch-module-identifier,
.record-module-identifier,
.field-module-identifier,
.let-value-identifier,
.switch-value-identifier,
.record-value-identifier,
.field-value-identifier,
.unused-identifier,
.declaration-var {
  color: #000;
} */



</style>
<pre id="main">
type <span class="declaration-var" data-id="1008">line</span> = ((<span class="type-value-identifier">float</span>, <span class="type-value-identifier">float</span>), (<span class="type-value-identifier">float</span>, <span class="type-value-identifier">float</span>));

let module <span class="declaration-var" data-id="1070">LineSet</span> = Set.Make({
  type <span class="declaration-var" data-id="1009">t</span> = <span class="type-value-identifier" data-id="1008">line</span>;
  let <span class="declaration-var" data-id="1010">compare</span> = <span class="value-identifier" data-global>compare</span>;
});

module <span class="declaration-var" data-id="1089">Animal</span> = {
  type <span class="declaration-var" data-id="1071">shape</span> = {
    collision: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Polygon</span>.<span class="type-value-identifier">t</span>,
    visual: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Polygon</span>.<span class="type-value-identifier">t</span>,
    box: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Aabb</span>.<span class="type-value-identifier">t</span>,
  };

  type <span class="declaration-var" data-id="1085">t</span> = {
    pos: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">point</span>,
    walkingShape: <span class="type-value-identifier" data-id="1071">shape</span>,
    eatingShape: <span class="type-value-identifier" data-id="1071">shape</span>,
  };
};

module <span class="declaration-var" data-id="1099">Arrow</span> = {
  type <span class="declaration-var" data-id="1090">kind</span> = | Wood | Stone | Iron;
  type <span class="declaration-var" data-id="1094">t</span> = {
    pos: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">point</span>,
    vel: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">vector</span>,
    <span class="type-value-identifier" data-id="1090">kind</span>,
    length: <span class="type-value-identifier">float</span>,
  };
};

module <span class="declaration-var" data-id="1111">Block</span> = {
  type <span class="declaration-var" data-id="1100">blockKind</span> = | Dirt | Rock;
  type <span class="declaration-var" data-id="1103">t</span> = {
    kind: <span class="type-value-identifier" data-id="1100">blockKind</span>,
    top: <span class="type-value-identifier">bool</span>,
    damage: <span class="type-value-identifier">float</span>,
    stuckArrows: <span class="type-value-identifier">list</span>(<span class="type-module-identifier" data-id="1099">Arrow</span>.<span class="type-value-identifier">t</span>),
  };
  let <span class="declaration-var" data-id="1108">init</span> = (<span class="declaration-var" data-id="1109">kind</span>, <span class="declaration-var" data-id="1110">top</span>) => {<span class="record-value-identifier" data-id="1109"><span class="value-identifier" data-id="1109">kind</span></span>, <span class="record-value-identifier">damage</span>: <span class="float">0.</span>, <span class="record-value-identifier">stuckArrows</span>: <span class="constructor-operator">[]</span>, <span class="record-value-identifier" data-id="1110"><span class="value-identifier" data-id="1110">top</span></span>};
};

module <span class="declaration-var" data-id="1120">Fruit</span> = {
  type <span class="declaration-var" data-id="1112">kind</span> = Apple | Peach;
  type <span class="declaration-var" data-id="1115">t</span> = {<span class="type-value-identifier" data-id="1112">kind</span>, vel: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">vector</span>, circle: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Circle</span>.<span class="type-value-identifier">t</span>, rotation: <span class="type-value-identifier">float</span>}
};

module <span class="declaration-var" data-id="1144">Stone</span> = {
  type <span class="declaration-var" data-id="1121">t</span> = {circle: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Circle</span>.<span class="type-value-identifier">t</span>, vel: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">vector</span>, rotation: <span class="type-value-identifier">float</span>, live: <span class="type-value-identifier">bool</span>};
  let <span class="declaration-var" data-id="1135">push</span> = (<span class="declaration-var" data-id="1136">stone</span>, <span class="declaration-var" data-id="1137">vec</span>) => {...<span class="value-identifier" data-id="1136">stone</span>, <span class="record-value-identifier">circle</span>: <span class="module-identifier">Geom</span>.<span class="module-identifier">Circle</span>.<span class="value-identifier">push</span>(<span class="value-identifier" data-id="1136">stone</span>.<span class="field-value-identifier">circle</span>, <span class="value-identifier" data-id="1137">vec</span>)};
  let <span class="declaration-var" data-id="1138">translate</span> = (<span class="declaration-var" data-id="1139">stone</span>, <span class="declaration-var" data-id="1140">pos</span>) => {...<span class="value-identifier" data-id="1139">stone</span>, <span class="record-value-identifier">circle</span>: <span class="module-identifier">Geom</span>.<span class="module-identifier">Circle</span>.<span class="value-identifier">translate</span>(<span class="value-identifier" data-id="1139">stone</span>.<span class="field-value-identifier">circle</span>, <span class="value-identifier" data-id="1140">pos</span>)};
  let <span class="declaration-var" data-id="1141">force</span> = (<span class="declaration-var" data-id="1142">stone</span>, <span class="declaration-var" data-id="1143">vec</span>) => {...<span class="value-identifier" data-id="1142">stone</span>, <span class="record-value-identifier">vel</span>: <span class="module-identifier">Geom</span>.<span class="value-identifier">addVectors</span>(<span class="value-identifier" data-id="1142">stone</span>.<span class="field-value-identifier">vel</span>, <span class="value-identifier" data-id="1143">vec</span>)};
};

module <span class="declaration-var" data-id="1151">FruitTree</span> = {
  type <span class="declaration-var" data-id="1145">t</span> = {
    pos: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">point</span>,
    growTimer: <span class="type-module-identifier">Timer</span>.<span class="type-value-identifier">t</span>,
    fruitTimer: <span class="type-module-identifier">Timer</span>.<span class="type-value-identifier">t</span>,
    fruitBox: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Aabb</span>.<span class="type-value-identifier">t</span>,
    fruit: <span class="type-value-identifier">list</span>((<span class="type-module-identifier" data-id="1120">Fruit</span>.<span class="type-value-identifier">t</span>, <span class="type-module-identifier">Timer</span>.<span class="type-value-identifier">t</span>))
  };
};

module <span class="declaration-var" data-id="1156">Projectile</span> = {
  type <span class="declaration-var" data-id="1152">kind</span> = Stone | Fruit(<span class="type-module-identifier" data-id="1120">Fruit</span>.<span class="type-value-identifier">kind</span>) | Arrow(<span class="type-module-identifier" data-id="1099">Arrow</span>.<span class="type-value-identifier">kind</span>);
};

module <span class="declaration-var" data-id="1166">Inventory</span> = {
  type <span class="declaration-var" data-id="1157">item</span> =
    | Nothing
    | Fruit(<span class="type-module-identifier" data-id="1120">Fruit</span>.<span class="type-value-identifier">kind</span>)
    | Stone
    | Arrow(<span class="type-module-identifier" data-id="1099">Arrow</span>.<span class="type-value-identifier">kind</span>);
  type <span class="declaration-var" data-id="1162">t</span> = {
    size: <span class="type-value-identifier">int</span>,
    slots: <span class="type-value-identifier">array</span>((<span class="type-value-identifier" data-id="1157">item</span>, <span class="type-value-identifier">int</span>)),
    selected: <span class="type-value-identifier">int</span>,
  };
};

type <span class="declaration-var" data-id="1167">player</span> = {
  /* pos: Geom.point, */
  vel: <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">vector</span>,
  box: <span class="type-module-identifier">Geom</span>.<span class="type-module-identifier">Rect</span>.<span class="type-value-identifier">t</span>,
  throwSkill: <span class="type-value-identifier">float</span>,
  facingLeft: <span class="type-value-identifier">bool</span>,
  isOnGround: <span class="type-value-identifier">bool</span>,
  walkTimer: <span class="type-value-identifier">float</span>,
  inventory: <span class="type-module-identifier" data-id="1166">Inventory</span>.<span class="type-value-identifier">t</span>,
  throw: <span class="type-value-identifier">option</span>((<span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">point</span>, <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">vector</span>, <span class="type-module-identifier" data-id="1144">Stone</span>.<span class="type-value-identifier">t</span>, <span class="type-value-identifier">float</span>)),
  actionTimer: <span class="type-module-identifier">Timer</span>.<span class="type-value-identifier">t</span>,
  skin: <span class="type-value-identifier">int</span>,
};

module <span class="declaration-var" data-id="1181">Player</span> = {
  let <span class="declaration-var" data-id="1178">force</span> = (<span class="declaration-var" data-id="1179">player</span>, <span class="declaration-var" data-id="1180">vec</span>) => {...<span class="value-identifier" data-id="1179">player</span>, <span class="record-value-identifier">vel</span>: <span class="module-identifier">Geom</span>.<span class="value-identifier">addVectors</span>(<span class="value-identifier" data-id="1179">player</span>.<span class="field-value-identifier">vel</span>, <span class="value-identifier" data-id="1180">vec</span>)};
};

type <span class="declaration-var" data-id="1182">userInput</span> = {
  left: <span class="type-value-identifier">bool</span>,
  right: <span class="type-value-identifier">bool</span>,
  up: <span class="type-value-identifier">bool</span>,
  down: <span class="type-value-identifier">bool</span>,
  jump: <span class="type-value-identifier">bool</span>,
  action: <span class="type-value-identifier">bool</span>,
};

type <span class="declaration-var" data-id="1189">state</span> = {
  blocks: <span class="type-value-identifier">array</span>(<span class="type-value-identifier">array</span>(<span class="type-value-identifier">option</span>(<span class="type-module-identifier" data-id="1111">Block</span>.<span class="type-value-identifier">t</span>))),
  textPos: <span class="type-value-identifier">list</span>((<span class="type-value-identifier">string</span>, <span class="type-module-identifier">Geom</span>.<span class="type-value-identifier">point</span>)),
  animals: <span class="type-value-identifier">list</span>(<span class="type-module-identifier" data-id="1089">Animal</span>.<span class="type-value-identifier">t</span>),
  trees: <span class="type-value-identifier">list</span>(<span class="type-module-identifier" data-id="1151">FruitTree</span>.<span class="type-value-identifier">t</span>),
  looseFruit: <span class="type-value-identifier">list</span>(<span class="type-module-identifier" data-id="1120">Fruit</span>.<span class="type-value-identifier">t</span>),
  stones: <span class="type-value-identifier">list</span>(<span class="type-module-identifier" data-id="1144">Stone</span>.<span class="type-value-identifier">t</span>),
  camera: (<span class="type-value-identifier">float</span>, <span class="type-value-identifier">float</span>, <span class="type-value-identifier">float</span>, <span class="type-value-identifier">float</span>),
  lastSavedHighScore: <span class="type-value-identifier">int</span>,
  paused: <span class="type-value-identifier">bool</span>,
  <span class="type-value-identifier" data-id="1182">userInput</span>,
  <span class="type-value-identifier" data-id="1167">player</span>,

  /* For debugging */
  zoom: <span class="type-value-identifier">bool</span>,
  frameByFrame: <span class="type-value-identifier">bool</span>,
  hitByHit: <span class="type-value-identifier">option</span>(<span class="type-value-identifier">int</span>),
};

type <span class="declaration-var" data-id="1204">status</span> =
  /* | AnimateIn(option((state, Timer.t, score)), state, Timer.t) */
  | Playing(<span class="type-value-identifier" data-id="1189">state</span>)
  ;

let <span class="declaration-var" data-id="1206">find</span> = (<span class="declaration-var" data-id="1207">arr</span>, <span class="declaration-var" data-id="1208">fn</span>) => {
  let rec <span class="declaration-var" data-id="1209">loop</span> = <span class="declaration-var" data-id="1210">i</span> => {
    if (<span class="value-identifier" data-id="1210">i</span> <span class="operator" data-global>>=</span> <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="value-identifier" data-id="1207">arr</span>)) {
      <span class="constructor-module-identifier">None</span>
    } else if (<span class="value-identifier" data-id="1208">fn</span>(<span class="module-identifier"><span class="value-identifier" data-id="1207">ar</span>r</span><span class="value-identifier">[<span class="value-identifier" data-id="1210">i</span>]</span>)) {
      <span class="constructor-module-identifier">Some</span>(<span class="value-identifier" data-id="1210">i</span>)
    } else {
      <span class="value-identifier" data-id="1209">loop</span>(<span class="value-identifier" data-id="1210">i</span> <span class="operator" data-global>+</span> <span class="int">1</span>)
    }
  };
  <span class="value-identifier" data-id="1209">loop</span>(<span class="int">0</span>)
};

let <span class="declaration-var" data-id="1211">blockSize</span> = <span class="float">40.</span>;

let <span class="declaration-var" data-id="1212">loopx</span> = (<span class="declaration-var" data-id="1213">blocks</span>, <span class="declaration-var" data-id="1214">x</span>) => {
  let <span class="declaration-var" data-id="1215">maxx</span> = <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="module-identifier"><span class="value-identifier" data-id="1213">block</span>s</span><span class="value-identifier">[<span class="int">0</span>]</span>) <span class="operator" data-global>-</span> <span class="int">1</span>;
  <span class="value-identifier" data-id="1214">x</span> <span class="operator" data-global><</span> <span class="int">0</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1215">maxx</span> <span class="operator" data-global>+</span> <span class="int">1</span> <span class="operator" data-global>+</span> <span class="value-identifier" data-id="1214">x</span> <span class="switch-value-identifier">:</span> (<span class="value-identifier" data-id="1214">x</span> <span class="operator" data-global>></span> <span class="value-identifier" data-id="1215">maxx</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1214">x</span> <span class="operator" data-global>-</span> <span class="value-identifier" data-id="1215">maxx</span> <span class="operator" data-global>-</span> <span class="int">1</span><span class="switch-value-identifier">:</span> <span class="value-identifier" data-id="1214">x</span>);
};

let <span class="declaration-var" data-id="1216">getBlock</span> = (<span class="declaration-var" data-id="1217">blocks</span>, (<span class="declaration-var" data-id="1218">x</span>, <span class="declaration-var" data-id="1219">y</span>)) => {
  let <span class="declaration-var" data-id="1220">maxy</span> = <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="value-identifier" data-id="1217">blocks</span>) <span class="operator" data-global>-</span> <span class="int">1</span>;
  if (<span class="value-identifier" data-id="1219">y</span> <span class="operator" data-global><</span> <span class="int">0</span> <span class="operator" data-global>||</span> <span class="value-identifier" data-id="1219">y</span> <span class="operator" data-global>></span> <span class="value-identifier" data-id="1220">maxy</span>) {
    <span class="constructor-module-identifier">None</span>
  } else {
    let <span class="declaration-var" data-id="1221">maxx</span> = <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="module-identifier"><span class="value-identifier" data-id="1217">block</span>s</span><span class="value-identifier">[<span class="int">0</span>]</span>) <span class="operator" data-global>-</span> <span class="int">1</span>;
    let <span class="declaration-var" data-id="1222">x</span> = <span class="value-identifier" data-id="1218">x</span> <span class="operator" data-global><</span> <span class="int">0</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1221">maxx</span> <span class="operator" data-global>+</span> <span class="int">1</span> <span class="operator" data-global>+</span> <span class="value-identifier" data-id="1218">x</span> <span class="switch-value-identifier">:</span> (<span class="value-identifier" data-id="1218">x</span> <span class="operator" data-global>></span> <span class="value-identifier" data-id="1221">maxx</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1218">x</span> <span class="operator" data-global>-</span> <span class="value-identifier" data-id="1221">maxx</span> <span class="operator" data-global>-</span> <span class="int">1</span><span class="switch-value-identifier">:</span> <span class="value-identifier" data-id="1218">x</span>);
    <span class="module-identifier"><span class="value-identifier" data-id="1217"><span class="module-identifier">block</span>s</span><span class="value-identifier">[<span class="value-identifier" data-id="1219">y</span></span>]</span><span class="value-identifier">[<span class="value-identifier" data-id="1222">x</span>]</span>
  }
};

let <span class="declaration-var" data-id="1223">getBlockf</span> = (<span class="declaration-var" data-id="1224">blocks</span>, {<span class="arg-module-identifier"><span class="declaration-var" data-id="1225">Geom</span>.<span class="arg-value-identifier">x</span></span>, <span class="arg-value-identifier" data-id="1226"><span class="declaration-var" data-id="1226">y</span></span>}, (<span class="declaration-var" data-id="1227">dx</span>, <span class="declaration-var" data-id="1228">dy</span>)) => {
  let <span class="declaration-var" data-id="1229">x</span> = <span class="value-identifier" data-global>int_of_float</span>(<span class="value-identifier" data-id="1225">x</span> <span class="operator" data-global>/.</span> <span class="value-identifier" data-id="1211">blockSize</span>) <span class="operator" data-global>+</span> <span class="value-identifier" data-id="1227">dx</span>;
  let <span class="declaration-var" data-id="1230">y</span> = <span class="value-identifier" data-global>int_of_float</span>(<span class="value-identifier" data-id="1226">y</span> <span class="operator" data-global>/.</span> <span class="value-identifier" data-id="1211">blockSize</span>) <span class="operator" data-global>+</span> <span class="value-identifier" data-id="1228">dy</span>;
  <span class="value-identifier" data-id="1216">getBlock</span>(<span class="value-identifier" data-id="1224">blocks</span>, (<span class="value-identifier" data-id="1229">x</span>, <span class="value-identifier" data-id="1230">y</span>))
};

let <span class="declaration-var" data-id="1231">blockPos</span> = ({<span class="arg-module-identifier"><span class="declaration-var" data-id="1232">Geom</span>.<span class="arg-value-identifier">x</span></span>, <span class="arg-value-identifier" data-id="1233"><span class="declaration-var" data-id="1233">y</span></span>}) => {
  (<span class="value-identifier" data-global>int_of_float</span>(<span class="value-identifier" data-id="1232">x</span> <span class="operator" data-global>/.</span> <span class="value-identifier" data-id="1211">blockSize</span>),
  <span class="value-identifier" data-global>int_of_float</span>(<span class="value-identifier" data-id="1233">y</span> <span class="operator" data-global>/.</span> <span class="value-identifier" data-id="1211">blockSize</span>))
};

let <span class="declaration-var" data-id="1234">hasBlock</span> = (<span class="declaration-var" data-id="1235">blocks</span>, (<span class="declaration-var" data-id="1236">x</span>, <span class="declaration-var" data-id="1237">y</span>)) => {
  let <span class="declaration-var" data-id="1238">maxy</span> = <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="value-identifier" data-id="1235">blocks</span>) <span class="operator" data-global>-</span> <span class="int">1</span>;
  if (<span class="value-identifier" data-id="1237">y</span> <span class="operator" data-global><</span> <span class="int">0</span> <span class="operator" data-global>||</span> <span class="value-identifier" data-id="1237">y</span> <span class="operator" data-global>></span> <span class="value-identifier" data-id="1238">maxy</span>) <span class="boolean">{
    false
  }</span> else {
    let <span class="declaration-var" data-id="1239">maxx</span> = <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="module-identifier"><span class="value-identifier" data-id="1235">block</span>s</span><span class="value-identifier">[<span class="int">0</span>]</span>) <span class="operator" data-global>-</span> <span class="int">1</span>;
    let <span class="declaration-var" data-id="1240">x</span> = <span class="value-identifier" data-id="1236">x</span> <span class="operator" data-global><</span> <span class="int">0</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1239">maxx</span> <span class="operator" data-global>+</span> <span class="int">1</span> <span class="operator" data-global>+</span> <span class="value-identifier" data-id="1236">x</span> <span class="switch-value-identifier">:</span> (<span class="value-identifier" data-id="1236">x</span> <span class="operator" data-global>></span> <span class="value-identifier" data-id="1239">maxx</span> <span class="switch-value-identifier">?</span> (<span class="value-identifier" data-id="1236">x</span> <span class="value-identifier" data-global>mod</span> <span class="value-identifier" data-id="1239">maxx</span>) <span class="operator" data-global>-</span> <span class="int">1</span> <span class="switch-value-identifier">:</span> <span class="value-identifier" data-id="1236">x</span>);
    <span class="module-identifier"><span class="value-identifier" data-id="1235"><span class="module-identifier">block</span>s</span><span class="value-identifier">[<span class="value-identifier" data-id="1237">y</span></span>]</span><span class="value-identifier">[<span class="value-identifier" data-id="1240">x</span>]</span> <span class="operator" data-global>!=</span> <span class="constructor-module-identifier">None</span>
  }
};

let <span class="declaration-var" data-id="1241">gameWidthInt</span> = <span class="int">120</span>;
let <span class="declaration-var" data-id="1242">gameWidth</span> = <span class="value-identifier" data-id="1211">blockSize</span> <span class="operator" data-global>*.</span> <span class="value-identifier" data-global>float_of_int</span>(<span class="value-identifier" data-id="1241">gameWidthInt</span>);

let <span class="declaration-var" data-id="1243">storageKey</span> = <span class="string">"throw-rocks"</span>;</pre>
<script>

  document.getElementById('main').addEventListener('mouseover', evt => {
    const id = evt.target.getAttribute('data-id')
    if (id) {
      [].map.call(document.querySelectorAll('[data-id="' + id + '"]'), el => {
        el.classList.add('hovered')
      })
    }
  })

  document.getElementById('main').addEventListener('mouseout', evt => {
    const id = evt.target.getAttribute('data-id')
    if (id) {
      [].map.call(document.querySelectorAll('[data-id="' + id + '"]'), el => {
        el.classList.remove('hovered')
      })
    }
  })

</script>
