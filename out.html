
<html>
<head>
<title>Reason code</title>
<script>

</script>
<style>
body {
  padding: 30px;
}
.value-identifier {
    color: #000;
}

.module-identifier {
  color: #aa0;
}

.let-module-identifier,
.constructor-module-identifier,
.switch-module-identifier,
.record-module-identifier,
.field-module-identifier {
  color: #a0a;
}

.let-value-identifier,
.switch-value-identifier,
.record-value-identifier,
.field-value-identifier {
  color: #0aa;
}

.unused-identifier {
  color: #00a;
}

.declaration-var {
  color: #a50000;
}

.string {
    color: #33a20d;
}

.int {
    color: blue;
}

.boolean {
    color: red;
}

.float {
    color: orange;
}

.operator {
  color: #9b9bff;
  font-weight: bold;
}

#main {
    color: #aaa;
    white-space: pre;
    font-family: 'sf mono', monospace;
}
.hovered {
  background-color: #d4ffe2;
}
span {
  display: inline-block;
  position: relative;
}
.id-badge {
  position: absolute;
  top: 100%;
  left: 0;
}
</style>
<pre id="main">open Play_types;
open Reprocessing;

let <span class="declaration-var" data-id="1054"><span class="id-badge">1054</span>textColor</span> = <span class="module-identifier">Constants</span>.<span class="value-identifier">black</span>;

open Play_draw_player;

let <span class="declaration-var" data-id="1055"><span class="id-badge">1055</span>spritePickerPos</span> = <span class="declaration-var" data-id="1056"><span class="id-badge">1056</span>env</span> => {
  <span class="module-identifier">Geom</span>.<span class="module-identifier">Rect</span>.<span class="value-identifier">create</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier">float_of_int</span>(<span class="module-identifier">Env</span>.<span class="value-identifier">width</span>(<span class="value-identifier" data-id="1056"><span class="id-badge">1056</span>env</span>)) <span class="operator">-.</span> <span class="float">30.</span>, <span class="record-value-identifier">y</span>: <span class="float">30.</span>}, <span class="float">50.</span>, <span class="float">60.</span>)
};

let <span class="declaration-var" data-id="1084"><span class="id-badge">1084</span>pauseButton</span> = <span class="declaration-var" data-id="1085"><span class="id-badge">1085</span>env</span> => {
  <span class="module-identifier">Geom</span>.<span class="module-identifier">Rect</span>.<span class="value-identifier">create</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier">float_of_int</span>(<span class="module-identifier">Env</span>.<span class="value-identifier">width</span>(<span class="value-identifier" data-id="1085"><span class="id-badge">1085</span>env</span>)) <span class="operator">-.</span> <span class="float">80.</span>, <span class="record-value-identifier">y</span>: <span class="float">30.</span>}, <span class="float">50.</span>, <span class="float">60.</span>)
};

let <span class="declaration-var" data-id="1086"><span class="id-badge">1086</span>rockPos</span> = (<span class="declaration-var" data-id="1087"><span class="id-badge">1087</span>state</span>, <span class="declaration-var" data-id="1088"><span class="id-badge">1088</span>v</span>, <span class="declaration-var" data-id="1089"><span class="id-badge">1089</span>env</span>) => {
  open Play_sprites;
  let module PlayerSprite = (val <span class="module-identifier">PlayerSprites</span>.<span class="value-identifier">getNum</span>(<span class="value-identifier" data-id="1087"><span class="id-badge">1087</span>state</span>.<span class="field-value-identifier">player</span>.<span class="field-value-identifier">skin</span>): PlayerSprites.Sprite);

  let <span class="declaration-var" data-id="1250"><span class="id-badge">1250</span>angle</span> = if (<span class="value-identifier" data-id="1088"><span class="id-badge">1088</span>v</span>.<span class="field-module-identifier">Geom</span>.<span class="field-value-identifier">magnitude</span> <span class="operator">></span> <span class="float">5.</span>) {
    let <span class="declaration-var" data-id="1251"><span class="id-badge">1251</span>percent</span> = <span class="value-identifier" data-id="1088"><span class="id-badge">1088</span>v</span>.<span class="field-module-identifier">Geom</span>.<span class="field-value-identifier">magnitude</span> <span class="operator">/.</span> <span class="float">200.</span>;
    let <span class="declaration-var" data-id="1252"><span class="id-badge">1252</span>extra</span> = <span class="module-identifier">Geom</span>.<span class="value-identifier">halfPi</span> <span class="operator">/.</span> <span class="float">2.</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1251"><span class="id-badge">1251</span>percent</span>;
    (<span class="value-identifier" data-id="1087"><span class="id-badge">1087</span>state</span>.<span class="field-value-identifier">player</span>.<span class="field-value-identifier">facingLeft</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1088"><span class="id-badge">1088</span>v</span>.<span class="field-module-identifier">Geom</span>.<span class="field-value-identifier">theta</span> <span class="operator">+.</span> <span class="value-identifier" data-id="1252"><span class="id-badge">1252</span>extra</span> <span class="switch-value-identifier">:</span> <span class="value-identifier" data-id="1088"><span class="id-badge">1088</span>v</span>.<span class="field-module-identifier">Geom</span>.<span class="field-value-identifier">theta</span> <span class="operator">+.</span> <span class="module-identifier">Geom</span>.<span class="value-identifier">pi</span> <span class="operator">-.</span> <span class="value-identifier" data-id="1252"><span class="id-badge">1252</span>extra</span>)
  } else <span class="float">{
    0.
  }</span>;
  let (<span class="declaration-var" data-id="1253"><span class="id-badge">1253</span>x</span>, <span class="declaration-var" data-id="1254"><span class="id-badge">1254</span>y</span>) = <span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="value-identifier" data-id="1087"><span class="id-badge">1087</span>state</span>.<span class="field-value-identifier">player</span>.<span class="field-value-identifier">box</span>.<span class="field-value-identifier">pos</span>);
  let <span class="declaration-var" data-id="1255"><span class="id-badge">1255</span>y</span> = <span class="value-identifier" data-id="1254"><span class="id-badge">1254</span>y</span> <span class="operator">-.</span> <span class="float">10.</span>;

  let <span class="declaration-var" data-id="1256"><span class="id-badge">1256</span>loff</span> = <span class="value-identifier" data-id="1087"><span class="id-badge">1087</span>state</span>.<span class="field-value-identifier">player</span>.<span class="field-value-identifier">facingLeft</span> <span class="switch-value-identifier">?</span> <span class="float">1.</span> <span class="switch-value-identifier">:</span> <span class="float">-1.</span>;
  let <span class="declaration-var" data-id="1257"><span class="id-badge">1257</span>armTop</span> = <span class="value-identifier" data-id="1255"><span class="id-badge">1255</span>y</span> <span class="operator">-.</span> <span class="module-identifier">PlayerSprite</span>.<span class="value-identifier">body_height</span> <span class="operator">*.</span> <span class="value-identifier">spriteScale</span> <span class="operator">/.</span> <span class="float">2.</span> <span class="operator">+.</span> <span class="float">10.</span>;
  let <span class="declaration-var" data-id="1258"><span class="id-badge">1258</span>arm</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier" data-id="1253"><span class="id-badge">1253</span>x</span> <span class="operator">+.</span> <span class="value-identifier">shoulder</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1256"><span class="id-badge">1256</span>loff</span> <span class="operator">*.</span> <span class="float">-1.</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1257"><span class="id-badge">1257</span>armTop</span>};
  let <span class="declaration-var" data-id="1259"><span class="id-badge">1259</span>relativeToArm</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">theta</span>: <span class="value-identifier" data-id="1250"><span class="id-badge">1250</span>angle</span> <span class="operator">+.</span> <span class="module-identifier">Geom</span>.<span class="value-identifier">halfPi</span>, <span class="record-value-identifier">magnitude</span>: <span class="module-identifier">PlayerSprite</span>.<span class="value-identifier">arm_height</span> <span class="operator">*.</span> <span class="value-identifier">spriteScale</span>};

  <span class="module-identifier">Geom</span>.<span class="value-identifier">addVectorToPoint</span>(<span class="value-identifier" data-id="1259"><span class="id-badge">1259</span>relativeToArm</span>, <span class="value-identifier" data-id="1258"><span class="id-badge">1258</span>arm</span>);
};


let <span class="declaration-var" data-id="1260"><span class="id-badge">1260</span>drawSpritePicker</span> = (<span class="declaration-var" data-id="1261"><span class="id-badge">1261</span>state</span>, <span class="declaration-var" data-id="1262"><span class="id-badge">1262</span>context</span>, <span class="declaration-var" data-id="1263"><span class="id-badge">1263</span>env</span>) => {
  open Play_sprites;
  let module PlayerSprite = (val <span class="module-identifier">PlayerSprites</span>.<span class="value-identifier">getNum</span>(<span class="value-identifier" data-id="1261"><span class="id-badge">1261</span>state</span>.<span class="field-value-identifier">player</span>.<span class="field-value-identifier">skin</span>): PlayerSprites.Sprite);
  let <span class="declaration-var" data-id="1285"><span class="id-badge">1285</span>rect</span> = <span class="value-identifier" data-id="1055"><span class="id-badge">1055</span>spritePickerPos</span>(<span class="value-identifier" data-id="1263"><span class="id-badge">1263</span>env</span>);

  let <span class="declaration-var" data-id="1286"><span class="id-badge">1286</span>scale</span> = <span class="value-identifier">spriteScale</span> <span class="operator">*.</span> <span class="float">1.3</span>;

  let <span class="declaration-var" data-id="1287"><span class="id-badge">1287</span>dx</span> = <span class="operator">-.</span><span class="module-identifier">PlayerSprite</span>.<span class="value-identifier">head_rx</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1286"><span class="id-badge">1286</span>scale</span>;
  let <span class="declaration-var" data-id="1288"><span class="id-badge">1288</span>dy</span> = <span class="operator">-.</span><span class="module-identifier">PlayerSprite</span>.<span class="value-identifier">head_height</span> <span class="operator">/.</span> <span class="float">2.</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1286"><span class="id-badge">1286</span>scale</span>;

  <span class="module-identifier">PlayerSprite</span>.<span class="value-identifier">head</span>(
    <span class="value-identifier" data-id="1262"><span class="id-badge">1262</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">charSheet</span>,
    ~scale=<span class="value-identifier" data-id="1286"><span class="id-badge">1286</span>scale</span>,
    /* ~flip=!state.player.facingLeft, */
    ~flip=<span class="boolean">false</span>,
    ~pos=(<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="value-identifier" data-id="1285"><span class="id-badge">1285</span>rect</span>.<span class="field-module-identifier">Geom</span>.<span class="field-module-identifier">Rect</span>.<span class="field-value-identifier">pos</span> <span class="operator">|></span> <span class="module-identifier">Geom</span>.<span class="value-identifier">addPectorToPoint</span>({<span class="record-module-identifier"><span class="value-identifier" data-id="1287"><span class="id-badge">1287</span>Geom</span>.<span class="record-value-identifier">dx</span></span>, <span class="record-value-identifier" data-id="1288"><span class="id-badge">1288</span><span class="value-identifier" data-id="1288"><span class="id-badge">1288</span>dy</span></span>}))),
    <span class="value-identifier" data-id="1263"><span class="id-badge">1263</span>env</span>
  );
};

let <span class="declaration-var" data-id="1289"><span class="id-badge">1289</span>maxWalk</span> = <span class="float">5.</span>;
let <span class="declaration-var" data-id="1290"><span class="id-badge">1290</span>walkSpeed</span> = <span class="float">0.5</span>;

let module MovePlayer = Play_collide.Mover({
  let <span class="declaration-var" data-id="1291"><span class="id-badge">1291</span>gravity</span> = <span class="float">0.5</span>;
  let <span class="declaration-var" data-id="1292"><span class="id-badge">1292</span>friction</span> = <span class="float">0.7</span>;
  let <span class="declaration-var" data-id="1293"><span class="id-badge">1293</span>jump</span> = <span class="float">11.</span>;
  let <span class="declaration-var" data-id="1294"><span class="id-badge">1294</span>bounce</span> = <span class="boolean">false</span>;
});

let <span class="declaration-var" data-id="1302"><span class="id-badge">1302</span>debugPlayerHits</span> = ({<span class="arg-value-identifier" data-id="1305"><span class="id-badge">1305</span><span class="declaration-var" data-id="1305"><span class="id-badge">1305</span>player</span></span>,<span class="arg-value-identifier" data-id="1304"><span class="id-badge">1304</span><span class="declaration-var" data-id="1304"><span class="id-badge">1304</span>userInput</span></span>, <span class="arg-value-identifier" data-id="1303"><span class="id-badge">1303</span><span class="declaration-var" data-id="1303"><span class="id-badge">1303</span>blocks</span></span>, <span class="arg-value-identifier" data-id="1306"><span class="id-badge">1306</span><span class="declaration-var" data-id="1306"><span class="id-badge">1306</span>hitByHit</span></span>}, <span class="declaration-var" data-id="1307"><span class="id-badge">1307</span>context</span>, <span class="declaration-var" data-id="1308"><span class="id-badge">1308</span>env</span>) => {
  let <span class="declaration-var" data-id="1309"><span class="id-badge">1309</span>vx</span> = <span class="module-identifier">Geom</span>.<span class="value-identifier">vx</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">vel</span>);
  let <span class="declaration-var" data-id="1310"><span class="id-badge">1310</span>acc</span> = <span class="value-identifier" data-id="1304"><span class="id-badge">1304</span>userInput</span>.<span class="field-value-identifier">left</span> <span class="switch-value-identifier">?</span> (<span class="value-identifier" data-id="1309"><span class="id-badge">1309</span>vx</span> <span class="operator">></span> <span class="operator">-.</span> <span class="value-identifier" data-id="1289"><span class="id-badge">1289</span>maxWalk</span> <span class="switch-value-identifier">?</span> Geom.{<span class="record-value-identifier">magnitude</span>: <span class="value-identifier" data-id="1290"><span class="id-badge">1290</span>walkSpeed</span>, <span class="record-value-identifier">theta</span>: <span class="value-identifier">pi</span>} <span class="switch-value-identifier">:</span> <span class="module-identifier">Geom</span>.<span class="value-identifier">v0</span>) <span class="switch-value-identifier">:</span> (
    <span class="value-identifier" data-id="1304"><span class="id-badge">1304</span>userInput</span>.<span class="field-value-identifier">right</span> <span class="switch-value-identifier">?</span> (<span class="value-identifier" data-id="1309"><span class="id-badge">1309</span>vx</span> <span class="operator"><</span> <span class="value-identifier" data-id="1289"><span class="id-badge">1289</span>maxWalk</span> <span class="switch-value-identifier">?</span> Geom.{<span class="record-value-identifier">magnitude</span>: <span class="value-identifier" data-id="1290"><span class="id-badge">1290</span>walkSpeed</span>, <span class="record-value-identifier">theta</span>: <span class="float">0.</span>} <span class="switch-value-identifier">:</span> <span class="module-identifier">Geom</span>.<span class="value-identifier">v0</span>) <span class="switch-value-identifier">:</span> <span class="module-identifier">Geom</span>.<span class="value-identifier">v0</span>
  );
  let (<span class="declaration-var" data-id="1381"><span class="id-badge">1381</span>isOnGround</span>, (<span class="declaration-var" data-id="1382"><span class="id-badge">1382</span>vel</span>, <span class="declaration-var" data-id="1383"><span class="id-badge">1383</span>hits</span>)) = <span class="module-identifier">MovePlayer</span>.<span class="value-identifier">moveObject</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>.<span class="field-value-identifier">pos</span>, <span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">vel</span>, <span class="value-identifier" data-id="1310"><span class="id-badge">1310</span>acc</span>, <span class="value-identifier" data-id="1304"><span class="id-badge">1304</span>userInput</span>.<span class="field-value-identifier">jump</span>, <span class="module-identifier">Play_collide</span>.<span class="value-identifier">testRect</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>), <span class="module-identifier">Play_collide</span>.<span class="value-identifier">collideRect</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>), <span class="value-identifier" data-id="1303"><span class="id-badge">1303</span>blocks</span>);
  /* let (isOnGround2, (vel2, hits2)) = MovePlayer.moveObject(player.box.pos, player.vel, acc, userInput.jump, Play_collide.testRect(player.box), Play_collide.collideRectOld(player.box), blocks); */
  <span class="module-identifier">Draw</span>.<span class="value-identifier">stroke</span>(<span class="module-identifier">Constants</span>.<span class="value-identifier">white</span>, <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
  <span class="module-identifier">Draw</span>.<span class="value-identifier">noFill</span>(<span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
  if (<span class="value-identifier">isOnGround</span>) {
    <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">rect</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>, <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>)
  };
  <span class="module-identifier">Draw</span>.<span class="value-identifier">strokeWeight</span>(<span class="int">1</span>, <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
  <span class="module-identifier">List</span>.<span class="value-identifier">iteri</span>(
    (<span class="declaration-var" data-id="1384"><span class="id-badge">1384</span>i</span>, (<span class="declaration-var" data-id="1385"><span class="id-badge">1385</span>oldVel</span>, <span class="declaration-var" data-id="1386"><span class="id-badge">1386</span>newVel</span>, <span class="declaration-var" data-id="1387"><span class="id-badge">1387</span>blockPos</span>, <span class="declaration-var" data-id="1388"><span class="id-badge">1388</span>playerMoved</span>, <span class="declaration-var" data-id="1389"><span class="id-badge">1389</span>blockBox</span>)) => {
      switch <span class="value-identifier" data-id="1306"><span class="id-badge">1306</span>hitByHit</span> {
      | <span class="switch-module-identifier">Some</span>(<span class="declaration-var" data-id="1390"><span class="id-badge">1390</span>index</span>) when <span class="value-identifier" data-id="1390"><span class="id-badge">1390</span>index</span> <span class="value-identifier">mod</span> <span class="module-identifier">List</span>.<span class="value-identifier">length</span>(<span class="value-identifier" data-id="1383"><span class="id-badge">1383</span>hits</span>) <span class="operator">!=</span> <span class="value-identifier" data-id="1384"><span class="id-badge">1384</span>i</span> => <span class="constructor-operator">()</span>
      | _ => {
        if (<span class="value-identifier" data-id="1306"><span class="id-badge">1306</span>hitByHit</span> <span class="operator">!=</span> <span class="constructor-module-identifier">None</span>) {
          <span class="module-identifier">Draw</span>.<span class="value-identifier">text</span>(~font=<span class="value-identifier" data-id="1307"><span class="id-badge">1307</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">smallFont</span>, ~body=<span class="string">"hi"</span>, ~pos=<span class="module-identifier">Geom</span>.<span class="value-identifier">intTuple</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>.<span class="field-value-identifier">pos</span>), <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
        };

        <span class="module-identifier">Draw</span>.<span class="value-identifier">stroke</span>(<span class="module-identifier">Constants</span>.<span class="value-identifier">white</span>, <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
        <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">aabb</span>(<span class="value-identifier" data-id="1389"><span class="id-badge">1389</span>blockBox</span>, <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
        let <span class="declaration-var" data-id="1405"><span class="id-badge">1405</span>pos</span> = <span class="module-identifier">Geom</span>.<span class="value-identifier">addPectorToPoint</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">dx</span>: <span class="float">2.</span> <span class="operator">*.</span> (<span class="value-identifier">float_of_int</span>(<span class="value-identifier" data-id="1384"><span class="id-badge">1384</span>i</span>)), <span class="record-value-identifier">dy</span>: <span class="float">2.</span> <span class="operator">*.</span> (<span class="value-identifier">float_of_int</span>(<span class="value-identifier" data-id="1384"><span class="id-badge">1384</span>i</span>))}, <span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>.<span class="field-value-identifier">pos</span>);
        <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">vec</span>(<span class="value-identifier" data-id="1405"><span class="id-badge">1405</span>pos</span>, <span class="module-identifier">Geom</span>.<span class="value-identifier">scaleVector</span>(<span class="value-identifier" data-id="1385"><span class="id-badge">1385</span>oldVel</span>, <span class="float">1.</span>), <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
        <span class="module-identifier">Draw</span>.<span class="value-identifier">stroke</span>(<span class="module-identifier">Constants</span>.<span class="value-identifier">red</span>, <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
        <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">rect</span>(<span class="module-identifier">Geom</span>.<span class="module-identifier">Rect</span>.<span class="value-identifier">ptranslate</span>(<span class="value-identifier" data-id="1305"><span class="id-badge">1305</span>player</span>.<span class="field-value-identifier">box</span>, <span class="value-identifier" data-id="1388"><span class="id-badge">1388</span>playerMoved</span>), <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>);
        <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">vec</span>(
          <span class="module-identifier">Geom</span>.<span class="value-identifier">addPectorToPoint</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">dx</span>: <span class="float">1.</span>, <span class="record-value-identifier">dy</span>: <span class="float">1.</span>}, <span class="value-identifier" data-id="1405"><span class="id-badge">1405</span>pos</span>),
          <span class="module-identifier">Geom</span>.<span class="value-identifier">scaleVector</span>(<span class="value-identifier" data-id="1386"><span class="id-badge">1386</span>newVel</span>, <span class="float">1.</span>),
          <span class="value-identifier" data-id="1308"><span class="id-badge">1308</span>env</span>)
      }

      }
    },
    <span class="value-identifier" data-id="1383"><span class="id-badge">1383</span>hits</span> <span class="operator">|></span> <span class="module-identifier">List</span>.<span class="value-identifier">rev</span>
  );

  /* List.iteri(
    (i, (oldVel, newVel, blockPos, playerMoved, blockBox)) => {
      Draw.stroke(Constants.green, env);
      GeomDraw.aabb(blockBox, env);
      let pos = Geom.addPectorToPoint({Geom.dx: 10. +. 2. *. (float_of_int(i)), dy: 10. +. 2. *. (float_of_int(i))}, player.box.pos);
      GeomDraw.vec(pos, Geom.scaleVector(oldVel, 1.), env);
      Draw.stroke(Constants.blue, env);
      GeomDraw.vec(
        Geom.addPectorToPoint({Geom.dx: 1., dy: 1.}, pos),
        Geom.scaleVector(newVel, 1.),
        env)
    },
    hits2 |> List.rev
  ); */

};

let <span class="declaration-var" data-id="1406"><span class="id-badge">1406</span>drawStones</span> = (<span class="declaration-var" data-id="1407"><span class="id-badge">1407</span>state</span>, <span class="declaration-var" data-id="1408"><span class="id-badge">1408</span>inPosition</span>, <span class="declaration-var" data-id="1409"><span class="id-badge">1409</span>context</span>, <span class="declaration-var" data-id="1410"><span class="id-badge">1410</span>env</span>) => {
  <span class="module-identifier">Draw</span>.<span class="value-identifier">fill</span>(<span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Utils</span>.<span class="value-identifier">color</span>(~r=<span class="int">150</span>, ~g=<span class="int">150</span>, ~b=<span class="int">170</span>, ~a=<span class="int">255</span>), <span class="value-identifier" data-id="1410"><span class="id-badge">1410</span>env</span>);
  <span class="value-identifier" data-id="1407"><span class="id-badge">1407</span>state</span>.<span class="field-value-identifier">stones</span> <span class="operator">|></span> <span class="module-identifier">List</span>.<span class="value-identifier">iter</span>(<span class="declaration-var" data-id="1411"><span class="id-badge">1411</span>stone</span> => {
    let {<span class="let-module-identifier"><span class="declaration-var" data-id="1412"><span class="id-badge">1412</span>Geom</span>.<span class="let-value-identifier">x</span></span>,<span class="let-value-identifier" data-id="1413"><span class="id-badge">1413</span><span class="declaration-var" data-id="1413"><span class="id-badge">1413</span>y</span></span>} = <span class="value-identifier" data-id="1411"><span class="id-badge">1411</span>stone</span>.<span class="field-module-identifier">Stone</span>.<span class="field-value-identifier">circle</span>.<span class="field-value-identifier">center</span>;
    switch (<span class="value-identifier" data-id="1408"><span class="id-badge">1408</span>inPosition</span>(<span class="float">200.</span>, <span class="value-identifier" data-id="1411"><span class="id-badge">1411</span>stone</span>.<span class="field-module-identifier">Stone</span>.<span class="field-value-identifier">circle</span>.<span class="field-value-identifier">center</span>)) {
    | <span class="switch-module-identifier">None</span> => <span class="constructor-operator">()</span>
    | <span class="switch-module-identifier">Some</span>(<span class="declaration-var" data-id="1418"><span class="id-badge">1418</span>pos</span>) => {
      <span class="value-identifier">drawStone</span>(<span class="value-identifier" data-id="1409"><span class="id-badge">1409</span>context</span>, <span class="value-identifier" data-id="1418"><span class="id-badge">1418</span>pos</span>, <span class="value-identifier" data-id="1411"><span class="id-badge">1411</span>stone</span>, <span class="value-identifier" data-id="1410"><span class="id-badge">1410</span>env</span>)
    }
    };
  });
};
let <span class="declaration-var" data-id="1419"><span class="id-badge">1419</span>drawStones</span> = (<span class="declaration-var" data-id="1420"><span class="id-badge">1420</span>a</span>, <span class="declaration-var" data-id="1421"><span class="id-badge">1421</span>b</span>, <span class="declaration-var" data-id="1422"><span class="id-badge">1422</span>c</span>, <span class="declaration-var" data-id="1423"><span class="id-badge">1423</span>d</span>) => {
  <span class="module-identifier">Profile</span>.<span class="value-identifier">start</span>(<span class="string">"drawStones"</span>);
  <span class="value-identifier" data-id="1406"><span class="id-badge">1406</span>drawStones</span>(<span class="value-identifier" data-id="1420"><span class="id-badge">1420</span>a</span>,<span class="value-identifier" data-id="1421"><span class="id-badge">1421</span>b</span>,<span class="value-identifier" data-id="1422"><span class="id-badge">1422</span>c</span>,<span class="value-identifier" data-id="1423"><span class="id-badge">1423</span>d</span>);
  <span class="module-identifier">Profile</span>.<span class="value-identifier">stop</span>(<span class="string">"drawStones"</span>);
};

let <span class="declaration-var" data-id="1424"><span class="id-badge">1424</span>drawTiles</span> = (<span class="declaration-var" data-id="1425"><span class="id-badge">1425</span>state</span>, <span class="declaration-var" data-id="1426"><span class="id-badge">1426</span>context</span>, <span class="declaration-var" data-id="1427"><span class="id-badge">1427</span>env</span>) => {
  let (<span class="declaration-var" data-id="1428"><span class="id-badge">1428</span>dx</span>, <span class="declaration-var" data-id="1429"><span class="id-badge">1429</span>dy</span>, <span class="declaration-var" data-id="1430"><span class="id-badge">1430</span>w</span>, <span class="declaration-var" data-id="1431"><span class="id-badge">1431</span>h</span>) = <span class="value-identifier" data-id="1425"><span class="id-badge">1425</span>state</span>.<span class="field-value-identifier">camera</span>;

  let <span class="declaration-var" data-id="1432"><span class="id-badge">1432</span>x0</span> = <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1428"><span class="id-badge">1428</span>dx</span> <span class="operator">/.</span> <span class="value-identifier">blockSize</span>) <span class="operator">-</span> <span class="int">1</span>;
  let <span class="declaration-var" data-id="1433"><span class="id-badge">1433</span>y0</span> = <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1429"><span class="id-badge">1429</span>dy</span> <span class="operator">/.</span> <span class="value-identifier">blockSize</span>);
  let <span class="declaration-var" data-id="1434"><span class="id-badge">1434</span>ww</span> = <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1430"><span class="id-badge">1430</span>w</span> <span class="operator">/.</span> <span class="value-identifier">blockSize</span>) <span class="operator">+</span> <span class="int">3</span>;
  let <span class="declaration-var" data-id="1435"><span class="id-badge">1435</span>hh</span> = <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1431"><span class="id-badge">1431</span>h</span> <span class="operator">/.</span> <span class="value-identifier">blockSize</span>) <span class="operator">+</span> <span class="int">3</span>;
  for (x in <span class="value-identifier" data-id="1432"><span class="id-badge">1432</span>x0</span> to <span class="value-identifier" data-id="1432"><span class="id-badge">1432</span>x0</span> <span class="operator">+</span> <span class="value-identifier" data-id="1434"><span class="id-badge">1434</span>ww</span>) {
    for (y in <span class="value-identifier" data-id="1433"><span class="id-badge">1433</span>y0</span> to <span class="value-identifier" data-id="1433"><span class="id-badge">1433</span>y0</span> <span class="operator">+</span> <span class="value-identifier" data-id="1435"><span class="id-badge">1435</span>hh</span>) {
      switch (<span class="value-identifier">getBlock</span>(<span class="value-identifier" data-id="1425"><span class="id-badge">1425</span>state</span>.<span class="field-value-identifier">blocks</span>, (<span class="value-identifier" data-id="1436"><span class="id-badge">1436</span>x</span>, <span class="value-identifier" data-id="1437"><span class="id-badge">1437</span>y</span>))) {
      | <span class="switch-module-identifier">None</span> => <span class="constructor-operator">()</span>
      | <span class="switch-module-identifier">Some</span>(<span class="declaration-var" data-id="1438"><span class="id-badge">1438</span>block</span>) => {

        let <span class="declaration-var" data-id="1439"><span class="id-badge">1439</span>x</span> = <span class="value-identifier">float_of_int</span>(<span class="value-identifier" data-id="1436"><span class="id-badge">1436</span>x</span>) <span class="operator">*.</span> <span class="value-identifier">blockSize</span> <span class="operator">+.</span> <span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">2.</span>;
        let <span class="declaration-var" data-id="1440"><span class="id-badge">1440</span>y</span> = <span class="value-identifier">float_of_int</span>(<span class="value-identifier" data-id="1437"><span class="id-badge">1437</span>y</span>) <span class="operator">*.</span> <span class="value-identifier">blockSize</span> <span class="operator">+.</span> <span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">2.</span>;
        let <span class="declaration-var" data-id="1441"><span class="id-badge">1441</span>sprite</span> = switch <span class="value-identifier" data-id="1438"><span class="id-badge">1438</span>block</span>.<span class="field-module-identifier">Block</span>.<span class="field-value-identifier">kind</span> {
        | <span class="switch-module-identifier">Block</span>.<span class="switch-module-identifier">Dirt</span> => <span class="module-identifier">Play_assets</span>.<span class="module-identifier">Tiles</span>.<span class="value-identifier">dirt</span>
        | <span class="switch-module-identifier">Block</span>.<span class="switch-module-identifier">Rock</span> => <span class="module-identifier">Play_assets</span>.<span class="module-identifier">Tiles</span>.<span class="value-identifier">stone</span>
        };

        let <span class="declaration-var" data-id="1445"><span class="id-badge">1445</span>xx</span> = <span class="value-identifier">mod_float</span>(<span class="value-identifier" data-id="1439"><span class="id-badge">1439</span>x</span>, <span class="value-identifier">gameWidth</span>);
        let <span class="declaration-var" data-id="1446"><span class="id-badge">1446</span>xx</span> = <span class="value-identifier" data-id="1445"><span class="id-badge">1445</span>xx</span> <span class="operator"><</span> <span class="float">0.</span> <span class="switch-value-identifier">?</span> <span class="value-identifier" data-id="1445"><span class="id-badge">1445</span>xx</span> <span class="operator">+.</span> <span class="value-identifier">gameWidth</span> <span class="switch-value-identifier">:</span> <span class="value-identifier" data-id="1445"><span class="id-badge">1445</span>xx</span>;
        let <span class="declaration-var" data-id="1447"><span class="id-badge">1447</span>rot</span> = <span class="value-identifier">floor</span>((<span class="value-identifier">sin</span>(<span class="value-identifier" data-id="1446"><span class="id-badge">1446</span>xx</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1446"><span class="id-badge">1446</span>xx</span> <span class="operator">+.</span> <span class="value-identifier" data-id="1440"><span class="id-badge">1440</span>y</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1440"><span class="id-badge">1440</span>y</span>) <span class="operator">+.</span> <span class="float">1.</span>) <span class="operator">/.</span> <span class="float">2.</span> <span class="operator">*.</span> <span class="float">4.</span>);
        let <span class="declaration-var" data-id="1448"><span class="id-badge">1448</span>rot</span> = <span class="value-identifier" data-id="1447"><span class="id-badge">1447</span>rot</span> <span class="operator">*.</span> <span class="module-identifier">Geom</span>.<span class="value-identifier">halfPi</span>;

        /* Draw.tint(Reprocessing.Utils.colorf(~r=0.3, ~g=0.5, ~b=1., ~a=1. *. (1. -. block.Block.damage)), env); */

        <span class="module-identifier">Draw</span>.<span class="value-identifier">pushMatrix</span>(<span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        <span class="module-identifier">Draw</span>.<span class="value-identifier">translate</span>(~<span class="value-identifier" data-id="1439"><span class="id-badge">1439</span>x</span>, ~<span class="value-identifier" data-id="1440"><span class="id-badge">1440</span>y</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        <span class="module-identifier">Draw</span>.<span class="value-identifier">rotate</span>(<span class="value-identifier" data-id="1448"><span class="id-badge">1448</span>rot</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        let <span class="declaration-var" data-id="1449"><span class="id-badge">1449</span>pos</span> = (<span class="operator">-.</span><span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">2.</span>, <span class="operator">-.</span><span class="value-identifier">blockSize</span><span class="operator">/.</span><span class="float">2.</span>);
        <span class="value-identifier" data-id="1441"><span class="id-badge">1441</span>sprite</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">tileSheet</span>, ~pos=<span class="value-identifier" data-id="1449"><span class="id-badge">1449</span>pos</span>, ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);

        <span class="module-identifier">Draw</span>.<span class="value-identifier">tint</span>(<span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Utils</span>.<span class="value-identifier">colorf</span>(~r=<span class="float">1.</span>, ~g=<span class="float">1.</span>, ~b=<span class="float">1.</span>, ~a=<span class="float">0.5</span>), <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        if (<span class="value-identifier" data-id="1438"><span class="id-badge">1438</span>block</span>.<span class="field-module-identifier">Block</span>.<span class="field-value-identifier">damage</span> <span class="operator">>=</span> <span class="float">0.7</span>) {
          <span class="module-identifier">Play_assets</span>.<span class="module-identifier">ExtraItems</span>.<span class="value-identifier">cracks3</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">extraItemsSheet</span>, ~<span class="value-identifier" data-id="1449"><span class="id-badge">1449</span>pos</span>, ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
          <span class="module-identifier">Play_assets</span>.<span class="module-identifier">ExtraItems</span>.<span class="value-identifier">cracks</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">extraItemsSheet</span>, ~<span class="value-identifier" data-id="1449"><span class="id-badge">1449</span>pos</span>, ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        } else if (<span class="value-identifier" data-id="1438"><span class="id-badge">1438</span>block</span>.<span class="field-module-identifier">Block</span>.<span class="field-value-identifier">damage</span> <span class="operator">>=</span> <span class="float">0.4</span>) {
          <span class="module-identifier">Play_assets</span>.<span class="module-identifier">ExtraItems</span>.<span class="value-identifier">cracks2</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">extraItemsSheet</span>, ~<span class="value-identifier" data-id="1449"><span class="id-badge">1449</span>pos</span>, ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
          <span class="module-identifier">Play_assets</span>.<span class="module-identifier">ExtraItems</span>.<span class="value-identifier">cracks</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">extraItemsSheet</span>, ~<span class="value-identifier" data-id="1449"><span class="id-badge">1449</span>pos</span>, ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        } else if (<span class="value-identifier" data-id="1438"><span class="id-badge">1438</span>block</span>.<span class="field-module-identifier">Block</span>.<span class="field-value-identifier">damage</span> <span class="operator">></span> <span class="float">0.</span>) {
          <span class="module-identifier">Play_assets</span>.<span class="module-identifier">ExtraItems</span>.<span class="value-identifier">cracks</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">extraItemsSheet</span>, ~<span class="value-identifier" data-id="1449"><span class="id-badge">1449</span>pos</span>, ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        };
        <span class="module-identifier">Draw</span>.<span class="value-identifier">noTint</span>(<span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);

        if (<span class="value-identifier" data-id="1438"><span class="id-badge">1438</span>block</span>.<span class="field-value-identifier">top</span>) {
          <span class="module-identifier">Draw</span>.<span class="value-identifier">rotate</span>(<span class="operator">-.</span><span class="value-identifier" data-id="1448"><span class="id-badge">1448</span>rot</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
          <span class="module-identifier">Play_assets</span>.<span class="module-identifier">ExtraItems</span>.<span class="value-identifier">grass_top</span>(<span class="value-identifier" data-id="1426"><span class="id-badge">1426</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">extraItemsSheet</span>, ~pos=(<span class="operator">-.</span><span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">2.</span>, <span class="operator">-.</span><span class="value-identifier">blockSize</span><span class="operator">/.</span><span class="float">2.</span>), ~scale=<span class="value-identifier">blockSize</span> <span class="operator">/.</span> <span class="float">128.</span>, ~flip=<span class="boolean">false</span>, <span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);
        };
        <span class="module-identifier">Draw</span>.<span class="value-identifier">popMatrix</span>(<span class="value-identifier" data-id="1427"><span class="id-badge">1427</span>env</span>);

        /* Draw.stroke(Constants.white, env);
        Draw.noFill(env);
        Draw.strokeWeight(1, env);
        GeomDraw.rect(Geom.Rect.create({Geom.x: x, y: y}, blockSize, blockSize), env); */

      }
      }
    }
  };

};
let <span class="declaration-var" data-id="1450"><span class="id-badge">1450</span>drawTiles</span> = (<span class="declaration-var" data-id="1451"><span class="id-badge">1451</span>a</span>, <span class="declaration-var" data-id="1452"><span class="id-badge">1452</span>b</span>, <span class="declaration-var" data-id="1453"><span class="id-badge">1453</span>c</span>) => {
  <span class="module-identifier">Profile</span>.<span class="value-identifier">start</span>(<span class="string">"drawTiles"</span>);
  <span class="value-identifier" data-id="1424"><span class="id-badge">1424</span>drawTiles</span>(<span class="value-identifier" data-id="1451"><span class="id-badge">1451</span>a</span>,<span class="value-identifier" data-id="1452"><span class="id-badge">1452</span>b</span>,<span class="value-identifier" data-id="1453"><span class="id-badge">1453</span>c</span>);
  <span class="module-identifier">Profile</span>.<span class="value-identifier">stop</span>(<span class="string">"drawTiles"</span>);
};

let <span class="declaration-var" data-id="1454"><span class="id-badge">1454</span>drawText</span> = (<span class="declaration-var" data-id="1455"><span class="id-badge">1455</span>state</span>, <span class="declaration-var" data-id="1456"><span class="id-badge">1456</span>inPosition</span>, <span class="declaration-var" data-id="1457"><span class="id-badge">1457</span>context</span>, <span class="declaration-var" data-id="1458"><span class="id-badge">1458</span>env</span>) => {
  <span class="value-identifier" data-id="1455"><span class="id-badge">1455</span>state</span>.<span class="field-value-identifier">textPos</span> <span class="operator">|></span> <span class="module-identifier">List</span>.<span class="value-identifier">iter</span>(((<span class="declaration-var" data-id="1459"><span class="id-badge">1459</span>text</span>, <span class="declaration-var" data-id="1460"><span class="id-badge">1460</span>pos</span>)) => {
    switch (<span class="value-identifier" data-id="1456"><span class="id-badge">1456</span>inPosition</span>(<span class="float">800.</span>, <span class="value-identifier" data-id="1460"><span class="id-badge">1460</span>pos</span>)) {
    | <span class="switch-module-identifier">None</span> => <span class="constructor-operator">()</span>
    | <span class="switch-module-identifier">Some</span>(<span class="declaration-var" data-id="1461"><span class="id-badge">1461</span>pos</span>) => {
      <span class="module-identifier">Draw</span>.<span class="value-identifier">tint</span>(<span class="module-identifier">Constants</span>.<span class="value-identifier">black</span>, <span class="value-identifier" data-id="1458"><span class="id-badge">1458</span>env</span>);
      <span class="module-identifier">Draw</span>.<span class="value-identifier">text</span>(~font=<span class="value-identifier" data-id="1457"><span class="id-badge">1457</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">smallFont</span>, ~pos=<span class="module-identifier">Geom</span>.<span class="value-identifier">intTuple</span>(<span class="value-identifier" data-id="1461"><span class="id-badge">1461</span>pos</span>), ~body=<span class="value-identifier" data-id="1459"><span class="id-badge">1459</span>text</span>, <span class="value-identifier" data-id="1458"><span class="id-badge">1458</span>env</span>);
      <span class="module-identifier">Draw</span>.<span class="value-identifier">noTint</span>(<span class="value-identifier" data-id="1458"><span class="id-badge">1458</span>env</span>);
      <span class="module-identifier">Draw</span>.<span class="value-identifier">text</span>(~font=<span class="value-identifier" data-id="1457"><span class="id-badge">1457</span>context</span>.<span class="field-module-identifier">Shared</span>.<span class="field-value-identifier">smallFont</span>, ~pos=<span class="module-identifier">Geom</span>.<span class="value-identifier">intTuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">addPoints</span>(<span class="value-identifier" data-id="1461"><span class="id-badge">1461</span>pos</span>, {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="float">-1.</span>, <span class="record-value-identifier">y</span>: <span class="float">-1.</span>})), ~body=<span class="value-identifier" data-id="1459"><span class="id-badge">1459</span>text</span>, <span class="value-identifier" data-id="1458"><span class="id-badge">1458</span>env</span>);
    }
    }
  });
};

let <span class="declaration-var" data-id="1462"><span class="id-badge">1462</span>drawText</span> = (<span class="declaration-var" data-id="1463"><span class="id-badge">1463</span>a</span>, <span class="declaration-var" data-id="1464"><span class="id-badge">1464</span>b</span>, <span class="declaration-var" data-id="1465"><span class="id-badge">1465</span>c</span>, <span class="declaration-var" data-id="1466"><span class="id-badge">1466</span>d</span>) => {
  <span class="module-identifier">Profile</span>.<span class="value-identifier">start</span>(<span class="string">"drawText"</span>);
  <span class="value-identifier" data-id="1454"><span class="id-badge">1454</span>drawText</span>(<span class="value-identifier" data-id="1463"><span class="id-badge">1463</span>a</span>,<span class="value-identifier" data-id="1464"><span class="id-badge">1464</span>b</span>,<span class="value-identifier" data-id="1465"><span class="id-badge">1465</span>c</span>, <span class="value-identifier" data-id="1466"><span class="id-badge">1466</span>d</span>);
  <span class="module-identifier">Profile</span>.<span class="value-identifier">stop</span>(<span class="string">"drawText"</span>);
};

let <span class="declaration-var" data-id="1467"><span class="id-badge">1467</span>drawWorld</span> = (<span class="declaration-var" data-id="1468"><span class="id-badge">1468</span>state</span>, <span class="declaration-var" data-id="1469"><span class="id-badge">1469</span>context</span>, <span class="declaration-var" data-id="1470"><span class="id-badge">1470</span>env</span>) => {
  <span class="module-identifier">Draw</span>.<span class="value-identifier">background</span>(<span class="module-identifier">Utils</span>.<span class="value-identifier">color</span>(~r=<span class="int">200</span>, ~g=<span class="int">230</span>, ~b=<span class="int">255</span>, ~a=<span class="int">255</span>), <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);
  /* Draw.background(Constants.white, env); */

  let (<span class="declaration-var" data-id="1471"><span class="id-badge">1471</span>dx</span>, <span class="declaration-var" data-id="1472"><span class="id-badge">1472</span>dy</span>, <span class="declaration-var" data-id="1473"><span class="id-badge">1473</span>w</span>, <span class="declaration-var" data-id="1474"><span class="id-badge">1474</span>h</span>) = <span class="value-identifier" data-id="1468"><span class="id-badge">1468</span>state</span>.<span class="field-value-identifier">camera</span>;

  /* let zoom = 5.; */
  let <span class="declaration-var" data-id="1475"><span class="id-badge">1475</span>zoom</span> = <span class="value-identifier" data-id="1468"><span class="id-badge">1468</span>state</span>.<span class="field-value-identifier">zoom</span> <span class="switch-value-identifier">?</span> <span class="float">4.</span> <span class="switch-value-identifier">:</span> <span class="float">1.</span>;
  <span class="module-identifier">Draw</span>.<span class="value-identifier">translate</span>(~x=<span class="operator">-.</span><span class="value-identifier" data-id="1471"><span class="id-badge">1471</span>dx</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1475"><span class="id-badge">1475</span>zoom</span>, ~y=<span class="operator">-.</span><span class="value-identifier" data-id="1472"><span class="id-badge">1472</span>dy</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1475"><span class="id-badge">1475</span>zoom</span>, <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);

  if (<span class="value-identifier" data-id="1468"><span class="id-badge">1468</span>state</span>.<span class="field-value-identifier">zoom</span>) {
    let <span class="declaration-var" data-id="1476"><span class="id-badge">1476</span>mpos</span> = <span class="module-identifier">Geom</span>.<span class="value-identifier">fromIntTuple</span>(<span class="module-identifier">Env</span>.<span class="value-identifier">mouse</span>(<span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>));
    let <span class="declaration-var" data-id="1477"><span class="id-badge">1477</span>mpos</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier" data-id="1473"><span class="id-badge">1473</span>w</span> <span class="operator">/.</span> <span class="float">2.</span> <span class="operator">-.</span> <span class="value-identifier" data-id="1473"><span class="id-badge">1473</span>w</span> <span class="operator">/.</span> <span class="float">8.</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1474"><span class="id-badge">1474</span>h</span> <span class="operator">/.</span> <span class="float">2.</span> <span class="operator">-.</span> <span class="value-identifier" data-id="1474"><span class="id-badge">1474</span>h</span> <span class="operator">/.</span> <span class="float">8.</span>};
    <span class="module-identifier">Draw</span>.<span class="value-identifier">translate</span>(~x=<span class="operator">-.</span><span class="value-identifier" data-id="1477"><span class="id-badge">1477</span>mpos</span>.<span class="field-value-identifier">x</span><span class="operator">*.</span><span class="value-identifier" data-id="1475"><span class="id-badge">1475</span>zoom</span>, ~y=<span class="operator">-.</span><span class="value-identifier" data-id="1477"><span class="id-badge">1477</span>mpos</span>.<span class="field-value-identifier">y</span> <span class="operator">*.</span> <span class="value-identifier" data-id="1475"><span class="id-badge">1475</span>zoom</span>, <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);
    <span class="module-identifier">Draw</span>.<span class="value-identifier">scale</span>(~x=<span class="value-identifier" data-id="1475"><span class="id-badge">1475</span>zoom</span>, ~y=<span class="value-identifier" data-id="1475"><span class="id-badge">1475</span>zoom</span>, <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);
  };

  <span class="value-identifier" data-id="1450"><span class="id-badge">1450</span>drawTiles</span>(<span class="value-identifier" data-id="1468"><span class="id-badge">1468</span>state</span>, <span class="value-identifier" data-id="1469"><span class="id-badge">1469</span>context</span>, <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);

  <span class="module-identifier">Draw</span>.<span class="value-identifier">noStroke</span>(<span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);
  <span class="value-identifier">drawPlayer</span>(<span class="value-identifier" data-id="1468"><span class="id-badge">1468</span>state</span>, <span class="value-identifier" data-id="1469"><span class="id-badge">1469</span>context</span>, <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);

  let <span class="declaration-var" data-id="1478"><span class="id-badge">1478</span>inPosition</span> = (<span class="declaration-var" data-id="1479"><span class="id-badge">1479</span>drawPadding</span>, {<span class="arg-module-identifier"><span class="declaration-var" data-id="1480"><span class="id-badge">1480</span>Geom</span>.<span class="arg-value-identifier">x</span></span>, <span class="arg-value-identifier" data-id="1481"><span class="id-badge">1481</span><span class="declaration-var" data-id="1481"><span class="id-badge">1481</span>y</span></span>} as <span class="declaration-var" data-id="1482"><span class="id-badge">1482</span>pos</span>) => {
    let <span class="declaration-var" data-id="1483"><span class="id-badge">1483</span>x0</span> = <span class="value-identifier" data-id="1471"><span class="id-badge">1471</span>dx</span> <span class="operator">-.</span> <span class="value-identifier" data-id="1479"><span class="id-badge">1479</span>drawPadding</span>;
    let <span class="declaration-var" data-id="1484"><span class="id-badge">1484</span>y0</span> = <span class="value-identifier" data-id="1472"><span class="id-badge">1472</span>dy</span> <span class="operator">-.</span> <span class="value-identifier" data-id="1479"><span class="id-badge">1479</span>drawPadding</span>;
    let <span class="declaration-var" data-id="1485"><span class="id-badge">1485</span>x1</span> = <span class="value-identifier" data-id="1471"><span class="id-badge">1471</span>dx</span> <span class="operator">+.</span> <span class="value-identifier" data-id="1473"><span class="id-badge">1473</span>w</span> <span class="operator">+.</span> <span class="value-identifier" data-id="1479"><span class="id-badge">1479</span>drawPadding</span>;
    let <span class="declaration-var" data-id="1486"><span class="id-badge">1486</span>y1</span> = <span class="value-identifier" data-id="1472"><span class="id-badge">1472</span>dy</span> <span class="operator">+.</span> <span class="value-identifier" data-id="1474"><span class="id-badge">1474</span>h</span> <span class="operator">+.</span> <span class="value-identifier" data-id="1479"><span class="id-badge">1479</span>drawPadding</span>;

    if (<span class="value-identifier" data-id="1481"><span class="id-badge">1481</span>y</span> <span class="operator">></span> <span class="value-identifier" data-id="1484"><span class="id-badge">1484</span>y0</span> <span class="operator">&&</span> <span class="value-identifier" data-id="1481"><span class="id-badge">1481</span>y</span> <span class="operator"><</span> <span class="value-identifier" data-id="1486"><span class="id-badge">1486</span>y1</span>) {
      if (<span class="value-identifier" data-id="1480"><span class="id-badge">1480</span>x</span> <span class="operator">></span> <span class="value-identifier" data-id="1483"><span class="id-badge">1483</span>x0</span> <span class="operator">&&</span> <span class="value-identifier" data-id="1480"><span class="id-badge">1480</span>x</span> <span class="operator"><</span> <span class="value-identifier" data-id="1485"><span class="id-badge">1485</span>x1</span>) {
        <span class="constructor-module-identifier">Some</span>(<span class="value-identifier" data-id="1482"><span class="id-badge">1482</span>pos</span>)
      } else {
        let <span class="declaration-var" data-id="1487"><span class="id-badge">1487</span>left</span> = <span class="value-identifier" data-id="1480"><span class="id-badge">1480</span>x</span> <span class="operator">-.</span> <span class="value-identifier">gameWidth</span>;
        if (<span class="value-identifier" data-id="1487"><span class="id-badge">1487</span>left</span> <span class="operator">></span> <span class="value-identifier" data-id="1483"><span class="id-badge">1483</span>x0</span> <span class="operator">&&</span> <span class="value-identifier" data-id="1487"><span class="id-badge">1487</span>left</span> <span class="operator"><</span> <span class="value-identifier" data-id="1485"><span class="id-badge">1485</span>x1</span>) {
          <span class="constructor-module-identifier">Some</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">addPoints</span>(<span class="value-identifier" data-id="1482"><span class="id-badge">1482</span>pos</span>, {<span class="record-value-identifier">x</span>: <span class="operator">-.</span><span class="value-identifier">gameWidth</span>, <span class="record-value-identifier">y</span>: <span class="float">0.</span>}))
        } else {
          let <span class="declaration-var" data-id="1488"><span class="id-badge">1488</span>right</span> = <span class="value-identifier" data-id="1480"><span class="id-badge">1480</span>x</span> <span class="operator">+.</span> <span class="value-identifier">gameWidth</span>;
          if (<span class="value-identifier" data-id="1488"><span class="id-badge">1488</span>right</span> <span class="operator">></span> <span class="value-identifier" data-id="1483"><span class="id-badge">1483</span>x0</span> <span class="operator">&&</span> <span class="value-identifier" data-id="1488"><span class="id-badge">1488</span>right</span> <span class="operator"><</span> <span class="value-identifier" data-id="1485"><span class="id-badge">1485</span>x1</span>) {
            <span class="constructor-module-identifier">Some</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">addPoints</span>(<span class="value-identifier" data-id="1482"><span class="id-badge">1482</span>pos</span>, {<span class="record-value-identifier">x</span>: <span class="operator">+.</span><span class="value-identifier">gameWidth</span>, <span class="record-value-identifier">y</span>: <span class="float">0.</span>}))
          } else {
            <span class="constructor-module-identifier">None</span>
          }
        }
      };
    } else {
      <span class="constructor-module-identifier">None</span>
    }
  };

  <span class="value-identifier" data-id="1419"><span class="id-badge">1419</span>drawStones</span>(<span class="value-identifier" data-id="1468"><span class="id-badge">1468</span>state</span>, <span class="value-identifier" data-id="1478"><span class="id-badge">1478</span>inPosition</span>, <span class="value-identifier" data-id="1469"><span class="id-badge">1469</span>context</span>, <span class="value-identifier" data-id="1470"><span class="id-badge">1470</span>env</span>);
  /* drawText(state, inPosition, context, env); */



  /* debugPlayerHits(state, context, env); */
};


let <span class="declaration-var" data-id="1489"><span class="id-badge">1489</span>drawWorld</span> = (<span class="declaration-var" data-id="1490"><span class="id-badge">1490</span>a</span>, <span class="declaration-var" data-id="1491"><span class="id-badge">1491</span>b</span>, <span class="declaration-var" data-id="1492"><span class="id-badge">1492</span>c</span>) => {
  <span class="module-identifier">Profile</span>.<span class="value-identifier">start</span>(<span class="string">"drawWorld"</span>);
  <span class="value-identifier" data-id="1467"><span class="id-badge">1467</span>drawWorld</span>(<span class="value-identifier" data-id="1490"><span class="id-badge">1490</span>a</span>, <span class="value-identifier" data-id="1491"><span class="id-badge">1491</span>b</span>, <span class="value-identifier" data-id="1492"><span class="id-badge">1492</span>c</span>);
  <span class="module-identifier">Profile</span>.<span class="value-identifier">stop</span>(<span class="string">"drawWorld"</span>);
};

let <span class="declaration-var" data-id="1493"><span class="id-badge">1493</span>touchButtons</span> = <span class="declaration-var" data-id="1494"><span class="id-badge">1494</span>env</span> => {
  let <span class="declaration-var" data-id="1495"><span class="id-badge">1495</span>bottom</span> = <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Env</span>.<span class="value-identifier">height</span>(<span class="value-identifier" data-id="1494"><span class="id-badge">1494</span>env</span>) <span class="operator">|></span> <span class="value-identifier">float_of_int</span>;
  let <span class="declaration-var" data-id="1496"><span class="id-badge">1496</span>right</span> = <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Env</span>.<span class="value-identifier">width</span>(<span class="value-identifier" data-id="1494"><span class="id-badge">1494</span>env</span>) <span class="operator">|></span> <span class="value-identifier">float_of_int</span>;
  let <span class="declaration-var" data-id="1497"><span class="id-badge">1497</span>buttonSize</span> = <span class="float">50.</span>;
  let <span class="declaration-var" data-id="1498"><span class="id-badge">1498</span>shape</span> = <span class="declaration-var" data-id="1499"><span class="id-badge">1499</span>pos</span> => {<span class="record-module-identifier">Geom</span>.<span class="record-module-identifier">Circle</span>.<span class="record-value-identifier">center</span>: <span class="value-identifier" data-id="1499"><span class="id-badge">1499</span>pos</span>, <span class="record-value-identifier">rad</span>: <span class="value-identifier" data-id="1497"><span class="id-badge">1497</span>buttonSize</span>};
  [
    <span class="constructor-operator"><span class="constructor-operator">(`Left, <span class="value-identifier" data-id="1498"><span class="id-badge">1498</span>shape</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="float">75.</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1495"><span class="id-badge">1495</span>bottom</span> <span class="operator">-.</span> <span class="float">75.</span>})),
    <span class="constructor-operator">(`Right, <span class="value-identifier" data-id="1498"><span class="id-badge">1498</span>shape</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="float">175.</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1495"><span class="id-badge">1495</span>bottom</span> <span class="operator">-.</span> <span class="float">75.</span>})),
    <span class="constructor-operator">(`Jump, <span class="value-identifier" data-id="1498"><span class="id-badge">1498</span>shape</span>({<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier" data-id="1496"><span class="id-badge">1496</span>right</span> <span class="operator">-.</span> <span class="float">75.</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1495"><span class="id-badge">1495</span>bottom</span> <span class="operator">-.</span> <span class="float">75.</span>})),</span></span></span></span>
  ]
};

let <span class="declaration-var" data-id="1509"><span class="id-badge">1509</span>drawControl</span> = (<span class="declaration-var" data-id="1510"><span class="id-badge">1510</span>control</span>, <span class="declaration-var" data-id="1511"><span class="id-badge">1511</span>pos</span>, <span class="declaration-var" data-id="1512"><span class="id-badge">1512</span>env</span>) => {
  open Geom;
  let <span class="declaration-var" data-id="1513"><span class="id-badge">1513</span>size</span> = <span class="float">50.</span>;
  let <span class="declaration-var" data-id="1514"><span class="id-badge">1514</span>p1</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="operator">-.</span><span class="value-identifier" data-id="1513"><span class="id-badge">1513</span>size</span> <span class="operator">*.</span> <span class="float">0.55</span>, <span class="record-value-identifier">y</span>: <span class="operator">-.</span><span class="value-identifier" data-id="1513"><span class="id-badge">1513</span>size</span> <span class="operator">*.</span> <span class="float">0.75</span>};
  let <span class="declaration-var" data-id="1515"><span class="id-badge">1515</span>p2</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier" data-id="1513"><span class="id-badge">1513</span>size</span> <span class="operator">*.</span> <span class="float">0.75</span>, <span class="record-value-identifier">y</span>: <span class="float">0.</span>};
  let <span class="declaration-var" data-id="1516"><span class="id-badge">1516</span>p3</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="operator">-.</span><span class="value-identifier" data-id="1513"><span class="id-badge">1513</span>size</span> <span class="operator">*.</span> <span class="float">0.55</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1513"><span class="id-badge">1513</span>size</span> <span class="operator">*.</span> <span class="float">0.75</span>};
  <span class="module-identifier">Draw</span>.<span class="value-identifier">noStroke</span>(<span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
  <span class="module-identifier">Draw</span>.<span class="value-identifier">fill</span>(<span class="module-identifier">Utils</span>.<span class="value-identifier">color</span>(~r=<span class="int">0</span>, ~g=<span class="int">0</span>, ~b=<span class="int">0</span>, ~a=<span class="int">50</span>), <span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
  /* Draw.strokeWeight(10, env); */
  <span class="module-identifier">Draw</span>.<span class="value-identifier">translate</span>(~x=<span class="value-identifier" data-id="1511"><span class="id-badge">1511</span>pos</span>.<span class="field-value-identifier">x</span>, ~y=<span class="value-identifier" data-id="1511"><span class="id-badge">1511</span>pos</span>.<span class="field-value-identifier">y</span>, <span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
  switch <span class="value-identifier" data-id="1510"><span class="id-badge">1510</span>control</span> {
  | `Left => {
    /* Draw.linef(~p1=Geom.tuple(p1), ~p2=Geom.tuple(p2), env); */
    /* Draw.linef(~p1=Geom.tuple(p2), ~p2=Geom.tuple(p3), env); */
    <span class="module-identifier">Draw</span>.<span class="value-identifier">trianglef</span>(~p1=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">flipX</span>(<span class="value-identifier" data-id="1514"><span class="id-badge">1514</span>p1</span>)), ~p2=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">flipX</span>(<span class="value-identifier" data-id="1515"><span class="id-badge">1515</span>p2</span>)), ~p3=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">flipX</span>(<span class="value-identifier" data-id="1516"><span class="id-badge">1516</span>p3</span>)), <span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
  }
  | `Right => {
    <span class="module-identifier">Draw</span>.<span class="value-identifier">trianglef</span>(~p1=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="value-identifier" data-id="1514"><span class="id-badge">1514</span>p1</span>), ~p2=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="value-identifier" data-id="1515"><span class="id-badge">1515</span>p2</span>), ~p3=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="value-identifier" data-id="1516"><span class="id-badge">1516</span>p3</span>), <span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
  }
  | _ => {
    <span class="module-identifier">Draw</span>.<span class="value-identifier">trianglef</span>(~p1=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">flipXY</span>(<span class="value-identifier" data-id="1514"><span class="id-badge">1514</span>p1</span>) <span class="operator">|></span> <span class="module-identifier">Geom</span>.<span class="value-identifier">flipY</span>), ~p2=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">flipXY</span>(<span class="value-identifier" data-id="1515"><span class="id-badge">1515</span>p2</span>) <span class="operator">|></span> <span class="module-identifier">Geom</span>.<span class="value-identifier">flipY</span>), ~p3=<span class="module-identifier">Geom</span>.<span class="value-identifier">tuple</span>(<span class="module-identifier">Geom</span>.<span class="value-identifier">flipXY</span>(<span class="value-identifier" data-id="1516"><span class="id-badge">1516</span>p3</span>) <span class="operator">|></span> <span class="module-identifier">Geom</span>.<span class="value-identifier">flipY</span>), <span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
  }
  };
  <span class="module-identifier">Draw</span>.<span class="value-identifier">translate</span>(~x=<span class="operator">-.</span><span class="value-identifier" data-id="1511"><span class="id-badge">1511</span>pos</span>.<span class="field-value-identifier">x</span>, ~y=<span class="operator">-.</span><span class="value-identifier" data-id="1511"><span class="id-badge">1511</span>pos</span>.<span class="field-value-identifier">y</span>, <span class="value-identifier" data-id="1512"><span class="id-badge">1512</span>env</span>);
};

let <span class="declaration-var" data-id="1517"><span class="id-badge">1517</span>joystickCircle</span> = <span class="declaration-var" data-id="1518"><span class="id-badge">1518</span>env</span> => {
  let <span class="declaration-var" data-id="1519"><span class="id-badge">1519</span>bottom</span> = <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Env</span>.<span class="value-identifier">height</span>(<span class="value-identifier" data-id="1518"><span class="id-badge">1518</span>env</span>) <span class="operator">|></span> <span class="value-identifier">float_of_int</span>;
  let <span class="declaration-var" data-id="1520"><span class="id-badge">1520</span>pos</span> = {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="float">100.</span>, <span class="record-value-identifier">y</span>: <span class="value-identifier" data-id="1519"><span class="id-badge">1519</span>bottom</span> <span class="operator">-.</span> <span class="float">100.</span>};
  {<span class="record-module-identifier">Geom</span>.<span class="record-module-identifier">Circle</span>.<span class="record-value-identifier">center</span>: <span class="value-identifier" data-id="1520"><span class="id-badge">1520</span>pos</span>, <span class="record-value-identifier">rad</span>: <span class="float">100.</span>}
};

let <span class="declaration-var" data-id="1521"><span class="id-badge">1521</span>arrayAssoc</span> = (<span class="declaration-var" data-id="1522"><span class="id-badge">1522</span>value</span>, <span class="declaration-var" data-id="1523"><span class="id-badge">1523</span>arr</span>) => {
  let rec <span class="declaration-var" data-id="1524"><span class="id-badge">1524</span>loop</span> = <span class="declaration-var" data-id="1525"><span class="id-badge">1525</span>i</span> => {
    if (<span class="value-identifier" data-id="1525"><span class="id-badge">1525</span>i</span> <span class="operator">>=</span> <span class="module-identifier">Array</span>.<span class="value-identifier">length</span>(<span class="value-identifier" data-id="1523"><span class="id-badge">1523</span>arr</span>)) {
      <span class="value-identifier">raise</span>(<span class="constructor-module-identifier">Not_found</span>)
    } else {
      let (<span class="declaration-var" data-id="1526"><span class="id-badge">1526</span>a</span>, <span class="declaration-var" data-id="1527"><span class="id-badge">1527</span>b</span>) = <span class="module-identifier"><span class="value-identifier" data-id="1523"><span class="id-badge">1523</span>ar</span>r</span><span class="value-identifier">[<span class="value-identifier" data-id="1525"><span class="id-badge">1525</span>i</span>]</span>;
      if (<span class="value-identifier" data-id="1526"><span class="id-badge">1526</span>a</span> <span class="operator">==</span> <span class="value-identifier" data-id="1522"><span class="id-badge">1522</span>value</span>) {
        <span class="value-identifier">b</span>
      } else {
        <span class="value-identifier" data-id="1524"><span class="id-badge">1524</span>loop</span>(<span class="value-identifier" data-id="1525"><span class="id-badge">1525</span>i</span><span class="operator">+</span><span class="int">1</span>)
      }
    }
  };
  <span class="value-identifier" data-id="1524"><span class="id-badge">1524</span>loop</span>(<span class="int">0</span>)
};

let <span class="declaration-var" data-id="1528"><span class="id-badge">1528</span>draw</span> = (<span class="declaration-var" data-id="1529"><span class="id-badge">1529</span>state</span>, <span class="declaration-var" data-id="1530"><span class="id-badge">1530</span>context</span>, <span class="declaration-var" data-id="1531"><span class="id-badge">1531</span>env</span>) => {
  <span class="module-identifier">Draw</span>.<span class="value-identifier">pushMatrix</span>(<span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  <span class="value-identifier" data-id="1489"><span class="id-badge">1489</span>drawWorld</span>(<span class="value-identifier" data-id="1529"><span class="id-badge">1529</span>state</span>, <span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  <span class="module-identifier">Draw</span>.<span class="value-identifier">popMatrix</span>(<span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);

  <span class="value-identifier">drawStone</span>(<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>, {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="float">15.</span>, <span class="record-value-identifier">y</span>: <span class="float">15.</span>}, {
    <span class="record-module-identifier">Play_types</span>.<span class="record-module-identifier">Stone</span>.<span class="record-value-identifier">circle</span>: {<span class="record-module-identifier">Geom</span>.<span class="record-module-identifier">Circle</span>.<span class="record-value-identifier">center</span>: <span class="module-identifier">Geom</span>.<span class="value-identifier">origin</span>, <span class="record-value-identifier">rad</span>: <span class="float">10.</span>},
    <span class="record-value-identifier">rotation</span>: <span class="float">0.</span>,
    <span class="record-value-identifier">vel</span>: <span class="module-identifier">Geom</span>.<span class="value-identifier">v0</span>,
    <span class="record-value-identifier">live</span>: <span class="boolean">true</span>,
  }, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  let <span class="declaration-var" data-id="1532"><span class="id-badge">1532</span>stones</span> = switch (<span class="value-identifier" data-id="1521"><span class="id-badge">1521</span>arrayAssoc</span>(<span class="constructor-module-identifier">Inventory</span>.<span class="constructor-module-identifier">Stone</span>, <span class="value-identifier" data-id="1529"><span class="id-badge">1529</span>state</span>.<span class="field-value-identifier">player</span>.<span class="field-value-identifier">inventory</span>.<span class="field-value-identifier">slots</span>)) {
  | exception <span class="switch-module-identifier">Not_found</span> => <span class="int">0</span>
  | <span class="declaration-var" data-id="1533"><span class="id-badge">1533</span>x</span> => <span class="value-identifier" data-id="1533"><span class="id-badge">1533</span>x</span>
  };
  <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Draw</span>.<span class="value-identifier">tint</span>(<span class="value-identifier" data-id="1054"><span class="id-badge">1054</span>textColor</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Draw</span>.<span class="value-identifier">text</span>(~font=<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>.<span class="field-value-identifier">smallFont</span>, ~body=<span class="module-identifier">Printf</span>.<span class="value-identifier">sprintf</span>(<span class="string">"%d"</span>, <span class="value-identifier" data-id="1532"><span class="id-badge">1532</span>stones</span>), ~pos=(<span class="int">30</span>, <span class="int">10</span>), <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);

  if (<span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Env</span>.<span class="value-identifier">isTouchScreen</span>(<span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>)) {
    /* Draw.fill(Utils.color(~r=0, ~g=0, ~b=0, ~a=50), env); */
    <span class="value-identifier" data-id="1493"><span class="id-badge">1493</span>touchButtons</span>(<span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>) <span class="operator">|></span> <span class="module-identifier">List</span>.<span class="value-identifier">iter</span>(((<span class="declaration-var" data-id="1534"><span class="id-badge">1534</span>action</span>, <span class="declaration-var" data-id="1535"><span class="id-badge">1535</span>shape</span>)) => {
      <span class="value-identifier" data-id="1509"><span class="id-badge">1509</span>drawControl</span>(<span class="value-identifier" data-id="1534"><span class="id-badge">1534</span>action</span>, <span class="value-identifier" data-id="1535"><span class="id-badge">1535</span>shape</span>.<span class="field-module-identifier">Geom</span>.<span class="field-module-identifier">Circle</span>.<span class="field-value-identifier">center</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
      /* GeomDraw.circle(shape, env); */
    });
    /* GeomDraw.circle(joystickCircle(env), env); */
  };

  <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Draw</span>.<span class="value-identifier">tint</span>(<span class="value-identifier" data-id="1054"><span class="id-badge">1054</span>textColor</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  /* Reprocessing.Draw.text(~font=context.textFont, ~body=Printf.sprintf("Throw rocks"), ~pos=(10, 10), env);
  let rocks = List.length(state.Play_types.stones);
  Reprocessing.Draw.text(~font=context.smallFont, ~body=Printf.sprintf("%d %s thrown", rocks, rocks == 1 ? "rock" : "rocks"), ~pos=(10, 40), env); */

  <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Draw</span>.<span class="value-identifier">text</span>(~font=<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>.<span class="field-value-identifier">smallFont</span>, ~body=<span class="string">"by Jared Forsyth"</span>, ~pos=(<span class="int">10</span>, <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>.<span class="field-value-identifier">height</span>) <span class="operator">-</span> <span class="int">60</span>), <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Draw</span>.<span class="value-identifier">text</span>(~font=<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>.<span class="field-value-identifier">smallFont</span>, ~body=<span class="string">"Made with ReasonML and Reprocessing"</span>, ~pos=(<span class="int">10</span>, <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>.<span class="field-value-identifier">height</span>) <span class="operator">-</span> <span class="int">30</span>), <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);


  let <span class="declaration-var" data-id="1536"><span class="id-badge">1536</span>w</span> = <span class="value-identifier">int_of_float</span>(<span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>.<span class="field-value-identifier">width</span>);
  /* Reprocessing.Draw.text(~font=context.smallFont, ~body="Tap & drag to throw a rock", ~pos=(w - 250, 10), env);
  Reprocessing.Draw.text(~font=context.smallFont, ~body="Space to change character", ~pos=(w - 250, 30), env); */

  <span class="module-identifier">Reprocessing</span>.<span class="module-identifier">Draw</span>.<span class="value-identifier">noTint</span>(<span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);

  <span class="value-identifier" data-id="1260"><span class="id-badge">1260</span>drawSpritePicker</span>(<span class="value-identifier" data-id="1529"><span class="id-badge">1529</span>state</span>, <span class="value-identifier" data-id="1530"><span class="id-badge">1530</span>context</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  /* GeomDraw.rect(pauseButton(env), env); */

  let <span class="declaration-var" data-id="1537"><span class="id-badge">1537</span>pause</span> = <span class="value-identifier" data-id="1084"><span class="id-badge">1084</span>pauseButton</span>(<span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  let <span class="declaration-var" data-id="1538"><span class="id-badge">1538</span>bar</span> = <span class="module-identifier">Geom</span>.<span class="module-identifier">Rect</span>.<span class="value-identifier">scale</span>(<span class="value-identifier" data-id="1537"><span class="id-badge">1537</span>pause</span>, <span class="float">0.3</span>, <span class="float">0.6</span>);
  let <span class="declaration-var" data-id="1539"><span class="id-badge">1539</span>left</span> = <span class="module-identifier">Geom</span>.<span class="module-identifier">Rect</span>.<span class="value-identifier">translate</span>(<span class="value-identifier" data-id="1538"><span class="id-badge">1538</span>bar</span>, {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="value-identifier" data-id="1537"><span class="id-badge">1537</span>pause</span>.<span class="field-module-identifier">Geom</span>.<span class="field-module-identifier">Rect</span>.<span class="field-value-identifier">width</span> <span class="operator">/.</span> <span class="float">4.</span>, <span class="record-value-identifier">y</span>: <span class="float">0.</span>});
  let <span class="declaration-var" data-id="1540"><span class="id-badge">1540</span>right</span> = <span class="module-identifier">Geom</span>.<span class="module-identifier">Rect</span>.<span class="value-identifier">translate</span>(<span class="value-identifier" data-id="1538"><span class="id-badge">1538</span>bar</span>, {<span class="record-module-identifier">Geom</span>.<span class="record-value-identifier">x</span>: <span class="operator">-.</span><span class="value-identifier" data-id="1537"><span class="id-badge">1537</span>pause</span>.<span class="field-module-identifier">Geom</span>.<span class="field-module-identifier">Rect</span>.<span class="field-value-identifier">width</span> <span class="operator">/.</span> <span class="float">4.</span>, <span class="record-value-identifier">y</span>: <span class="float">0.</span>});
  <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">rect</span>(<span class="value-identifier" data-id="1539"><span class="id-badge">1539</span>left</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);
  <span class="module-identifier">GeomDraw</span>.<span class="value-identifier">rect</span>(<span class="value-identifier" data-id="1540"><span class="id-badge">1540</span>right</span>, <span class="value-identifier" data-id="1531"><span class="id-badge">1531</span>env</span>);

  /* Draw.noFill(env);
  Draw.stroke(Constants.black, env);
  Draw.tint(Constants.black, env);
  Hashtbl.iter((k, v) => {
    GeomDraw.circle({Geom.Circle.center: Geom.fromTuple(v), rad: 20.}, env);
    let (x,y) = v;
    Draw.text(~font=context.smallFont, ~body=string_of_float(k), ~pos=(
      int_of_float(x +. 30.),
      int_of_float(y),
    ), env)
  }, Env.touches(env));
  Draw.noTint(env); */
};

/* let draw = GeomDebug.draw; */</pre>
<script>

  document.getElementById('main').addEventListener('mouseover', evt => {
    const id = evt.target.getAttribute('data-id')
    if (id) {
      [].map.call(document.querySelectorAll('[data-id="' + id + '"]'), el => {
        el.classList.add('hovered')
      })
    }
  })

  document.getElementById('main').addEventListener('mouseout', evt => {
    const id = evt.target.getAttribute('data-id')
    if (id) {
      [].map.call(document.querySelectorAll('[data-id="' + id + '"]'), el => {
        el.classList.remove('hovered')
      })
    }
  })

</script>
